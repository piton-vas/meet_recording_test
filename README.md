# Тестовый проект для записи Яндекс Телемост

Этот проект представляет собой тестовый скрипт для автоматизированного подключения к конференции Яндекс Телемост, включения записи на заданное время и отключения.

## Требования

- Python 3.10+
- Google Chrome
- Доступ к конференции Яндекс Телемост

## Установка

1. Клонируйте репозиторий:
```bash
git clone [URL репозитория]
cd meet_recording_test
```

2. Создайте виртуальное окружение и активируйте его:
```bash
python -m venv .venv
.venv\Scripts\activate  # для Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл .env на основе .env.example и заполните необходимые параметры:
```bash
cp .env.example .env
```

## Конфигурация

В файле `.env` необходимо указать следующие параметры:

- `ENV` - режим работы приложения:
  - `prod` - для запуска на сервере Ubuntu (по умолчанию)
  - `local` - для локального запуска с Chrome for Testing
- `TELEMOST_URL` - URL конференции Яндекс Телемост
- `USER_NAME` - имя пользователя для входа в конференцию (по умолчанию "Test User")
- `RECORD_TIME` - время записи в секундах (по умолчанию 60)
- `DOWNLOAD_PATH` - путь для сохранения записей (по умолчанию "downloads")

## Запуск

### Локальный запуск (Windows)

Для локального запуска на Windows используется Chrome for Testing. Убедитесь, что:
1. У вас установлен Chrome for Testing (не обычный Chrome)
2. В файле `.env` установлен режим `ENV=local`

Запуск скрипта:

```bash
# Из виртуального окружения .venv
python telemost.py
```

### Запуск на сервере (Ubuntu)

На сервере используется обычный Google Chrome, который устанавливается автоматически при деплое (см. DEPLOY.md).

Запуск через systemd сервис:
```bash
# Запуск сервиса
sudo systemctl start telemost

# Проверка статуса
sudo systemctl status telemost

# Просмотр логов
sudo journalctl -u telemost -f
```

Ручной запуск на сервере (для отладки):
```bash
cd /opt/meet_recording_test
source .venv/bin/activate
python telemost.py
```

## Логирование

Логи сохраняются в директории `logs` с именем файла в формате `telemost_YYYYMMDD_HHMMSS.log`.

## Структура проекта

```
meet_recording_test/
├── .env.example        # Пример конфигурационного файла
├── .env               # Конфигурационный файл (создается пользователем)
├── requirements.txt   # Зависимости проекта
├── telemost.py       # Основной скрипт
├── downloads/        # Директория для сохранения записей
└── logs/            # Директория для логов
```

## Особенности работы

1. Скрипт автоматически:
   - Подключается к конференции
   - Отключает микрофон и камеру
   - Начинает запись
   - Ждет указанное время
   - Останавливает запись
   - Закрывает браузер

2. Все действия логируются в файл

## Примечания

- Скрипт использует Chrome WebDriver, который автоматически скачивается при первом запуске
- Для работы в CI/CD окружении добавлены специальные опции Chrome (--no-sandbox, --disable-dev-shm-usage)
- Автоматически разрешается доступ к микрофону и камере (которые затем отключаются)
